<div class="container mt-5">
  <div class="">
      <h3>Lista de Proveedores</h3>

      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Filtros</h5>

          <!-- Primera fila con buscadores -->
          <div class="row align-items-center">
            <div class="col-lg-8 d-flex">
                <input 
                    type="text" 
                    placeholder="Buscar"
                    class="form-control w-50 col-lg-4">
                <button class="btn btn-dark col-lg-1 mx-1" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
                <button class="btn btn-outline-secondary col-lg-1 mx-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
                        <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"/>
                    </svg>
                </button>
            </div>
      
            <!-- Espaciador para la separación -->
            <div class="col-lg-2"></div> <!-- Espacio más largo en el medio -->
      
            <div class="col-lg-2 d-flex justify-content-end">
              <button class="btn btn-primary mx-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>
            <button class="btn btn-success mx-1" (click)="exportToExcel()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-excel" viewBox="0 0 16 16" style="width: 20px; height: 20px;">
                    <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                </svg>
            </button>
            <button class="btn btn-danger mx-1" (click)="exportToPDF()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-pdf" viewBox="0 0 16 16" style="width: 20px; height: 20px;">
                    <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                </svg>
            </button>
            </div>
          </div>

          <!-- Primera fila con los 3 filtros dinámicos -->
          <div class="row g-3 mb-3 mt-3">
            <div class="col-md-3">
              <input type="text" 
                     class="form-control" 
                     placeholder="Nombre"
                     [formControl]="nameFilter">
            </div>
            <div class="col-md-3">
              <input type="text" 
                     class="form-control" 
                     placeholder="CUIL"
                     [formControl]="cuilFilter">
            </div>
            <div class="col-md-3">
              <input type="text" 
                     class="form-control" 
                     placeholder="Servicio"
                     [formControl]="serviceFilter">
            </div>

            <div class="col-md-3">
              <input type="text" 
                     class="form-control" 
                     placeholder="Numero de telefono"
                     [formControl]="phoneFilter">
            </div>           
          </div>
      
          <!-- FormGroup con los selects y botones -->
          <form [formGroup]="filterForm" class="row g-3">
            <!-- Primera fila del form -->
            <div class="col-md-3">
              <select class="form-select" formControlName="addressId">
                <option value="">Todas las direcciones</option>
                <option *ngFor="let address of addresses" [value]="address.id">
                  {{address.street_address}}, {{address.city}}
                </option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" formControlName="enabled">
                <option value="">Todos los Estados</option>
                <option [value]="true">Activo</option>
                <option [value]="false">Inactivo</option>
              </select>
            </div>
            <div class="col-md-3">
              <button class="btn btn-success w-100" (click)="exportToExcel()">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-file-earmark-excel" viewBox="0 0 16 16">
                  <path d="M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"/>
                  <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                </svg>
                Excel
              </button>
            </div>
            <div class="col-md-3">
              <button class="btn btn-danger w-100" (click)="exportToPDF()">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-filetype-pdf" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                </svg>
                PDF
              </button>
            </div>
            <div class="col-md-3 w-100">
              <button class="btn btn-secondary w-100" (click)="clearSearch()">
                Limpiar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="isLoading" class="text-center my-3">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- Mensaje de no hay resultados -->
      <div *ngIf="!isLoading && filteredProviders.length === 0" class="alert alert-info">
        No se encontraron proveedores con los filtros seleccionados.
      </div>
      
      <div class="table-responsive" *ngIf="!isLoading && filteredProviders.length > 0">
        <table class="table table-hover border rounded-lg overflow-hidden">
          <thead class="bg-dark text-white">
            <tr>
              <th class="py-3 px-4 font-semibold" (click)="sortProviders('name')">
                Nombre <span [ngClass]="{'asc': sortColumn === 'name' && sortDirection === 'asc', 'desc': sortColumn === 'name' && sortDirection === 'desc'}">⇅</span>
              </th>
              <th class="py-3 px-4 font-semibold" (click)="sortProviders('cuil')">
                CUIL <span [ngClass]="{'asc': sortColumn === 'cuil' && sortDirection === 'asc', 'desc': sortColumn === 'cuil' && sortDirection === 'desc'}">⇅</span>
              </th>
              <th class="py-3 px-4 font-semibold" (click)="sortProviders('service')">
                Servicio <span [ngClass]="{'asc': sortColumn === 'service' && sortDirection === 'asc', 'desc': sortColumn === 'service' && sortDirection === 'desc'}">⇅</span>
              </th>
              <th class="py-3 px-4 font-semibold" (click)="sortProviders('addressId')">
                Dirección <span [ngClass]="{'asc': sortColumn === 'addressId' && sortDirection === 'asc', 'desc': sortColumn === 'addressId' && sortDirection === 'desc'}">⇅</span>
              </th>
              
                <th class="py-3 px-4 font-semibold" (click)="sortProviders('phoneNumber')">
                Numero de telefono <span [ngClass]="{'asc': sortColumn === 'phoneNumber' && sortDirection === 'asc', 'desc': sortColumn === 'phoneNumber' && sortDirection === 'desc'}">⇅</span>
              </th>
              <th class="py-3 px-4 font-semibold" (click)="sortProviders('enabled')">
                Estado <span [ngClass]="{'asc': sortColumn === 'enabled' && sortDirection === 'asc', 'desc': sortColumn === 'enabled' && sortDirection === 'desc'}">⇅</span>
              </th>
              
              <th class="py-3 px-4 font-semibold">Acciones</th>
            </tr>
          </thead>
          <tbody class="bg-white">
            <tr *ngFor="let item of providerList; trackBy: trackByFn" class="border-b border-gray-200 hover:bg-gray-50">
              <td class="py-3 px-4">{{ item.name }}</td>
              <td class="py-3 px-4">{{ item.cuil }}</td>
              <td class="py-3 px-4">{{ item.service }}</td>
              <td class="py-3 px-4">{{ getAddressById(item.addressId) }}</td>
              <td class="py-3 px-4">{{ item.phoneNumber}}</td>
              <td class="py-3 px-4">{{ item.enabled ? 'Activo' : 'Inactivo' }}</td>
              <td class="py-3 px-4">
                <button *ngIf="item.id !== undefined" 
                        (click)="editProvider(item.id!)" 
                        class="btn btn-sm rounded-md me-2 text-dark"
                        style="background-color: #f59e0b; border-color: #d97706;"
                        onmouseover="this.style.backgroundColor='#d97706';" 
                        onmouseout="this.style.backgroundColor='#f59e0b';">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="black" class="bi bi-pencil-square" viewBox="0 0 16 16">
                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                  </svg>
                </button>
                <button *ngIf="item.id !== undefined" 
                        (click)="deleteProvider(item.id!)" 
                        class="btn btn-sm rounded-md text-dark"
                        style="background-color: #ef4444; border-color: #dc2626;"
                        onmouseover="this.style.backgroundColor='#dc2626';" 
                        onmouseout="this.style.backgroundColor='#ef4444';">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="black" class="bi bi-trash" viewBox="0 0 16 16">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
  </div>
</div>